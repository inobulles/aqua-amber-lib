// gl shaders

import lib/devices/gl/gl.a
var gl_shader_zero = 0;

class Gl_shader {
	Device->var device;
	var program_pointer;
	
	var vert_shader_code;
	var frag_shader_code;
	var geom_shader_code;
	
	func construct(var vert_shader_code, var frag_shader_code, var geom_shader_code) {
		self.vert_shader_code = vert_shader_code;
		self.frag_shader_code = frag_shader_code;
		self.geom_shader_code = geom_shader_code;
		
		self.device = new(Device).construct("shader");
		self.device.send 0x63, &self.program_pointer, self.vert_shader_code, self.frag_shader_code, self.geom_shader_code;
		
		return self;
	}
	
	func uniform_location(var string) return ?self.device.send(0x67, &self.program_pointer, string);
	
	func set_uniform(var location, var data, var type) { // hybrid
		if (self) self.device.send 0x73, location, data, type;
		else Device.send "shader", 0x73, location, data, type;
	}
	
	func default { // static
		Device.send "shader", 0x75, &gl_shader_zero;
	}
	
	func use { // hybrid
		if (self) self.device.send 0x75, &self.program_pointer;
		else default();
	}
}
